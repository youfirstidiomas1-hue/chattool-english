<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Class Interface</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Capa superior: Herramienta de texto */
        #tool-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 160px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
            z-index: 10; padding: 20px; box-sizing: border-box;
            display: flex; flex-direction: column-reverse; gap: 10px; overflow-y: auto;
        }

        .sentence {
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px);
            padding: 8px 15px; border-radius: 30px; width: fit-content;
            display: flex; gap: 8px; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: fadeIn 0.4s ease-out;
        }

        .word-btn { cursor: pointer; color: #333; font-weight: 500; padding: 2px 4px; border-radius: 4px; }
        .word-btn:hover { background: #6366f1; color: white; }
        
        .frozen { background: #ffeb3b !important; border: 2px solid #fbc02d; }

        /* Capa inferior: Video */
        #whereby-frame { width: 100%; height: 100vh; border: none; }

        #mic-control {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 20; background: #6366f1; color: white; border: none;
            padding: 12px 25px; border-radius: 50px; cursor: pointer; font-weight: bold;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="tool-layer"></div>

<button id="mic-control">Start English Voice Detection</button>

<iframe id="whereby-frame" 
    src="https://whereby.com/coachlaura7" 
    allow="camera; microphone; fullscreen; speaker; display-capture">
</iframe>

<script>
    // PEGA AQUÃ TU CONFIGURACIÃ“N DE FIREBASE
    const firebaseConfig = {
        apiKey: "TU_API_KEY",
        databaseURL: "TU_DATABASE_URL",
        projectId: "TU_PROJECT_ID",
        appId: "TU_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const frasesRef = db.ref('live_session/frases');

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.continuous = true;

    document.getElementById('mic-control').onclick = () => {
        recognition.start();
        document.getElementById('mic-control').style.background = '#ef4444';
        document.getElementById('mic-control').innerText = 'ðŸŽ¤ Listening...';
    };

    recognition.onresult = (event) => {
        const text = event.results[event.results.length - 1][0].transcript;
        frasesRef.push({ texto: text, timestamp: Date.now() });
    };

    frasesRef.on('child_added', (snapshot) => {
        const data = snapshot.val();
        renderSentence(data.texto, snapshot.key);
    });

    function renderSentence(texto, id) {
        const row = document.createElement('div');
        row.className = 'sentence';
        row.id = id;

        const pin = document.createElement('span');
        pin.innerText = "ðŸ“Œ";
        pin.style.cursor = "pointer";
        pin.onclick = () => row.classList.toggle('frozen');
        row.appendChild(pin);

        texto.split(' ').forEach(word => {
            const span = document.createElement('span');
            span.className = 'word-btn';
            span.innerText = word;
            span.onclick = () => alert("Definition for: " + word); // AquÃ­ conectaremos la IA luego
            row.appendChild(span);
        });

        document.getElementById('tool-layer').prepend(row);

        setTimeout(() => {
            if (!row.classList.contains('frozen')) {
                row.style.opacity = '0';
                setTimeout(() => row.remove(), 1000);
            }
        }, 45000); // 45 segundos
    }
</script>
</body>
</html>